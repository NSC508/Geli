{% extends "base.html" %}
{% block title %}Rankings{% endblock %}

{% block content %}
<div class="rankings-header">
    <h1>Your {{ media_config.singular }} Rankings</h1>
    <p class="rankings-subtitle">
        {% if total == 0 %}
        No {{ media_config.label|lower }} ranked yet. <a href="{{ url_for('search_page', media_type=media_type) }}">Add
            your first {{ media_config.singular|lower }}!</a>
        {% elif total < 10 %} {{ total }} {{ media_config.singular|lower }}{{ 's' if total !=1 else '' }} ranked ‚Äî add
            {{ 10 - total }} more to unlock scores! {% else %} {{ total }} {{ media_config.label|lower }} ranked {%
            endif %} </p>
</div>

{% if total > 0 %}
<!-- Overall Ranking -->
<div class="overall-ranking">
    <div class="tier-header overall-header">
        <span class="tier-emoji">üèÜ</span>
        <h2>Overall Ranking</h2>
        <span class="tier-count">{{ total }}</span>
    </div>
    <div class="games-list">
        {% set ns = namespace(rank=1) %}
        {% for item in all_items %}
        <div class="game-card" data-external-id="{{ item.external_id }}">
            <div class="game-rank">#{{ ns.rank }}</div>
            {% set ns.rank = ns.rank + 1 %}
            <div class="game-cover">
                {% if item.cover_url %}
                <img src="{{ item.cover_url }}" alt="{{ item.name }}" loading="lazy">
                {% else %}
                <div class="no-cover">{{ media_config.emoji }}</div>
                {% endif %}
            </div>
            <div class="game-info">
                <h3 class="game-title">{{ item.name }}</h3>
                <span class="game-meta">
                    {% if item.release_year %}{{ item.release_year }}{% endif %}
                    {% if item.meta_line %} ¬∑ {{ item.meta_line }}{% endif %}
                </span>
            </div>
            <span class="tier-badge tier-badge-{{ item.tier }}">
                {% if item.tier == 'like' %}üî•{% elif item.tier == 'neutral' %}üòê{% else %}üëé{% endif %}
            </span>
            {% if show_scores %}
            <div class="game-score score-{{ item.tier }}">{{ "%.1f"|format(item.score) }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<div class="tier-columns">
    <!-- LIKED -->
    <div class="tier-column tier-like">
        <div class="tier-header">
            <span class="tier-emoji">üî•</span>
            <h2>Liked</h2>
            <span class="tier-count">{{ liked|length }}</span>
            {% if show_scores %}<span class="tier-range">7.0 ‚Äì 10.0</span>{% endif %}
        </div>
        <div class="games-list">
            {% for item in liked %}
            <div class="game-card" data-external-id="{{ item.external_id }}">
                <div class="game-rank">#{{ item.rank_position }}</div>
                <div class="game-cover">
                    {% if item.cover_url %}
                    <img src="{{ item.cover_url }}" alt="{{ item.name }}" loading="lazy">
                    {% else %}
                    <div class="no-cover">{{ media_config.emoji }}</div>
                    {% endif %}
                </div>
                <div class="game-info">
                    <h3 class="game-title">{{ item.name }}</h3>
                    <span class="game-meta">
                        {% if item.release_year %}{{ item.release_year }}{% endif %}
                        {% if item.meta_line %} ¬∑ {{ item.meta_line }}{% endif %}
                    </span>
                </div>
                {% if show_scores %}
                <div class="game-score score-like">{{ "%.1f"|format(item.score) }}</div>
                {% endif %}
                <button class="remove-btn" onclick="removeItem('{{ item.external_id }}', '{{ item.name|e }}')"
                    title="Remove">√ó</button>
            </div>
            {% endfor %}
            {% if liked|length == 0 %}
            <div class="empty-tier">No liked {{ media_config.label|lower }} yet</div>
            {% endif %}
        </div>
    </div>

    <!-- NEUTRAL -->
    <div class="tier-column tier-neutral">
        <div class="tier-header">
            <span class="tier-emoji">üòê</span>
            <h2>Neutral</h2>
            <span class="tier-count">{{ neutral|length }}</span>
            {% if show_scores %}<span class="tier-range">4.0 ‚Äì 7.0</span>{% endif %}
        </div>
        <div class="games-list">
            {% for item in neutral %}
            <div class="game-card" data-external-id="{{ item.external_id }}">
                <div class="game-rank">#{{ item.rank_position }}</div>
                <div class="game-cover">
                    {% if item.cover_url %}
                    <img src="{{ item.cover_url }}" alt="{{ item.name }}" loading="lazy">
                    {% else %}
                    <div class="no-cover">{{ media_config.emoji }}</div>
                    {% endif %}
                </div>
                <div class="game-info">
                    <h3 class="game-title">{{ item.name }}</h3>
                    <span class="game-meta">
                        {% if item.release_year %}{{ item.release_year }}{% endif %}
                        {% if item.meta_line %} ¬∑ {{ item.meta_line }}{% endif %}
                    </span>
                </div>
                {% if show_scores %}
                <div class="game-score score-neutral">{{ "%.1f"|format(item.score) }}</div>
                {% endif %}
                <button class="remove-btn" onclick="removeItem('{{ item.external_id }}', '{{ item.name|e }}')"
                    title="Remove">√ó</button>
            </div>
            {% endfor %}
            {% if neutral|length == 0 %}
            <div class="empty-tier">No neutral {{ media_config.label|lower }} yet</div>
            {% endif %}
        </div>
    </div>

    <!-- DISLIKED -->
    <div class="tier-column tier-dislike">
        <div class="tier-header">
            <span class="tier-emoji">üëé</span>
            <h2>Disliked</h2>
            <span class="tier-count">{{ disliked|length }}</span>
            {% if show_scores %}<span class="tier-range">1.0 ‚Äì 4.0</span>{% endif %}
        </div>
        <div class="games-list">
            {% for item in disliked %}
            <div class="game-card" data-external-id="{{ item.external_id }}">
                <div class="game-rank">#{{ item.rank_position }}</div>
                <div class="game-cover">
                    {% if item.cover_url %}
                    <img src="{{ item.cover_url }}" alt="{{ item.name }}" loading="lazy">
                    {% else %}
                    <div class="no-cover">{{ media_config.emoji }}</div>
                    {% endif %}
                </div>
                <div class="game-info">
                    <h3 class="game-title">{{ item.name }}</h3>
                    <span class="game-meta">
                        {% if item.release_year %}{{ item.release_year }}{% endif %}
                        {% if item.meta_line %} ¬∑ {{ item.meta_line }}{% endif %}
                    </span>
                </div>
                {% if show_scores %}
                <div class="game-score score-dislike">{{ "%.1f"|format(item.score) }}</div>
                {% endif %}
                <button class="remove-btn" onclick="removeItem('{{ item.external_id }}', '{{ item.name|e }}')"
                    title="Remove">√ó</button>
            </div>
            {% endfor %}
            {% if disliked|length == 0 %}
            <div class="empty-tier">No disliked {{ media_config.label|lower }} yet</div>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">{{ media_config.emoji }}</div>
    <h2>Start Rating {{ media_config.label }}</h2>
    <p>Search for a {{ media_config.singular|lower }} and tell us how you feel about it.</p>
    <a href="{{ url_for('search_page', media_type=media_type) }}" class="btn btn-primary">Add Your First {{
        media_config.singular }}</a>
</div>
{% endif %}
{% endblock %}